pipeline {
  agent any

  tools {
    nodejs 'node24'
  }

  environment {
    BUN_INSTALL = "%USERPROFILE%\\.bun"
    PATH = "%USERPROFILE%\\.bun\\bin;%PATH%"
  }

  stages {

    stage('Checkout') {
      steps {
        checkout scm
      }
    }

    stage('Verify Node') {
      steps {
        bat '''
          node -v
          npm -v
        '''
      }
    }

    stage('Install Bun') {
      steps {
        bat '''
          where bun >nul 2>nul
          if %ERRORLEVEL% NEQ 0 (
            powershell -Command "irm https://bun.sh/install.ps1 | iex"
          )
          bun -v
        '''
      }
    }

    stage('Install Dependencies') {
      steps {
        bat 'bun install'
      }
    }

    stage('Build Next.js App') {
      steps {
        bat 'bun run build'
      }
    }
  }

  post {
    success {
      echo '✅ Windows + Node 24 + Bun + Next.js build successful'
    }
    failure {
      echo '❌ Build failed'
    }
  }
}
